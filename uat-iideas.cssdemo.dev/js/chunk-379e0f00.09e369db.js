(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-379e0f00"],{"0db2":function(e,t,a){"use strict";a("de39")},"38cf":function(e,t,a){var i=a("23e7"),s=a("1148");i({target:"String",proto:!0},{repeat:s})},de39:function(e,t,a){},ed40:function(e,t,a){"use strict";a.r(t);a("caad"),a("fb6a");var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"template-designer-app"},[t("b-navbar",{staticClass:"flex-shrink-0",attrs:{variant:"dark",type:"dark"}},[t("b-container",{attrs:{fluid:""}},[t("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"outline-light"},on:{click:e.goBackToEvent}},[t("b-icon-arrow-left"),e._v(" Back ")],1),t("b-button-group",{staticClass:"mr-3",attrs:{size:"sm"}},[t("b-button",{attrs:{variant:"secondary",disabled:!e.canUndo,title:"Undo (Ctrl+Z)"},on:{click:e.undo}},[t("b-icon-arrow-counterclockwise"),e._v(" Undo ")],1),t("b-button",{attrs:{variant:"secondary",disabled:!e.canRedo,title:"Redo (Ctrl+Y)"},on:{click:e.redo}},[t("b-icon-arrow-clockwise"),e._v(" Redo ")],1)],1),t("b-navbar-brand",{attrs:{href:"#"}},[e._v(" Dynamic Backdrop Designer "),t("b-badge",{staticClass:"ml-2",staticStyle:{"font-size":"0.8rem","vertical-align":"middle"},attrs:{variant:"info"}},[e._v(" "+e._s(e.luckyDrawType||"General")+" Section ")]),t("span",{staticClass:"ml-2 text-muted",staticStyle:{"font-size":"0.7rem"}},[e._v("ID: "+e._s(e.designId))])],1),t("div",{staticClass:"d-none d-md-block text-white-50 small mx-auto"},[t("span",{staticClass:"mr-3"},[t("b-icon-info-circle"),e._v(" Hint: Hold "),t("b",[e._v("SHIFT")]),e._v(" to drag border without content")],1),t("span",[t("b-icon-layers"),e._v(" Use "),t("b",[e._v("Layers Panel")]),e._v(" to select overlapping items")],1)]),t("b-navbar-nav",{staticClass:"ml-auto d-flex align-items-center"},[t("div",{staticClass:"d-flex flex-column align-items-end mr-3",staticStyle:{"line-height":"1.2"}},[t("span",{staticClass:"small font-weight-bold"},[e.hasUnsavedChanges?t("span",{staticClass:"text-warning"},[e._v("Unsaved to Server")]):t("span",{staticClass:"text-success"},[e._v("Server Synced")])]),t("span",{staticClass:"small text-white-50",staticStyle:{"font-size":"0.75rem"}},["saving"===e.draftStatus?t("span",[t("b-spinner",{staticStyle:{width:"0.5rem",height:"0.5rem"},attrs:{small:"",type:"grow"}}),e._v(" Saving Draft... ")],1):"saved"===e.draftStatus?t("span",[t("b-icon-check2"),e._v(" Draft Saved Locally ")],1):e._e()])]),t("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"success",disabled:!e.hasUnsavedChanges},on:{click:e.saveTemplate}},[t("b-icon-save",{staticClass:"mr-1"}),e._v(" Save Template ")],1),e.isTemplateSaved?t("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:e.deleteTemplate}},[t("b-icon-trash",{staticClass:"mr-1"}),e._v(" Delete Template ")],1):e._e(),t("b-button",{staticClass:"ml-3",attrs:{size:"sm",variant:"primary"},on:{click:e.exportJson}},[t("b-icon-upload",{staticClass:"mr-1"}),e._v(" Export JSON ")],1)],1)],1)],1),t("b-container",{staticClass:"flex-grow-1 overflow-hidden",attrs:{fluid:""}},[t("b-row",{staticClass:"h-100"},[t("b-col",{staticClass:"bg-white border-right p-0 d-flex flex-column h-100",attrs:{md:"2"}},[t("div",{staticClass:"p-2 border-bottom flex-shrink-0"},[t("h6",{staticClass:"mb-0 text-primary"},[e._v("Template Elements")])]),t("div",{staticClass:"palette-content p-2 overflow-auto flex-grow-1"},[t("div",{directives:[{name:"b-toggle",rawName:"v-b-toggle.collapse-custom",modifiers:{"collapse-custom":!0}}],staticClass:"category-header mt-2"},[t("h5",{staticClass:"category-title"},[e._v("Available Tools")]),e.isCustomFieldsVisible?t("b-icon-chevron-up"):t("b-icon-chevron-down")],1),t("b-collapse",{attrs:{id:"collapse-custom"},model:{value:e.isCustomFieldsVisible,callback:function(t){e.isCustomFieldsVisible=t},expression:"isCustomFieldsVisible"}},[t("b-row",{staticClass:"g-2 pt-2",attrs:{cols:"1"}},e._l(e.allCustomFields,(function(a){return t("b-col",{key:a.label},[t("div",{staticClass:"field-item p-2 border rounded text-center",attrs:{draggable:"true"},on:{dragstart:function(t){return e.handlePaletteDragStart(t,a)},click:function(t){return e.handlePaletteItemClick(a)}}},["text"===a.type?t("b-icon-type",{staticClass:"text-primary",attrs:{"font-scale":"1.5"}}):"background_upload"===a.type?t("b-icon-card-image",{staticClass:"text-success",attrs:{"font-scale":"1.5"}}):"rectangle"===a.type?t("b-icon-square",{staticClass:"text-primary",attrs:{"font-scale":"1.5"}}):"lucky_draw"===a.type?t("b-icon-hash",{staticClass:"text-danger",attrs:{"font-scale":"1.5"}}):t("b-icon-trophy",{staticClass:"text-warning",attrs:{"font-scale":"1.5"}}),t("div",{staticClass:"field-label mt-2"},[e._v(e._s(a.label))])],1)])})),1)],1)],1)]),t("b-col",{staticClass:"p-0 d-flex align-items-center justify-content-center overflow-hidden bg-light position-relative",attrs:{md:"8"}},[t("div",{staticClass:"ruler-grid-container",style:e.rulerGridStyle},[t("div",{staticClass:"ruler-corner"}),t("div",{staticClass:"ruler-h"},[t("svg",{attrs:{width:"100%",height:"100%"}},e._l(e.xTicks,(function(a){return t("g",{key:a},[t("line",{attrs:{x1:a,y1:"0",x2:a,y2:"20",stroke:"#999","stroke-width":"1"}}),a%100===0?t("text",{attrs:{x:a+2,y:"12","font-size":"9",fill:"#555","font-family":"Arial"}},[e._v(e._s(a))]):e._e(),a+50<e.canvasSize.width?t("line",{attrs:{x1:a+50,y1:"12",x2:a+50,y2:"20",stroke:"#ccc","stroke-width":"1"}}):e._e()])})),0)]),t("div",{staticClass:"ruler-v"},[t("svg",{attrs:{width:"100%",height:"100%"}},e._l(e.yTicks,(function(a){return t("g",{key:a},[t("line",{attrs:{x1:"0",y1:a,x2:"20",y2:a,stroke:"#999","stroke-width":"1"}}),a%100===0?t("text",{staticStyle:{"writing-mode":"vertical-rl","text-orientation":"mixed"},attrs:{x:"2",y:a+10,"font-size":"9",fill:"#555","font-family":"Arial"}},[e._v(e._s(a))]):e._e(),a+50<e.canvasSize.height?t("line",{attrs:{x1:"12",y1:a+50,x2:"20",y2:a+50,stroke:"#ccc","stroke-width":"1"}}):e._e()])})),0)]),t("div",{ref:"canvasWrapper",staticClass:"canvas-area",style:e.canvasSizeStyle,on:{drop:e.handleCanvasDrop,dragover:function(e){e.preventDefault()},dragenter:function(e){e.preventDefault()},click:e.deselectField}},[t("div",{staticClass:"display-preview",style:e.backgroundStyle},[t("div",{staticClass:"guidelines-overlay"},e._l(e.alignmentLines,(function(e,a){return t("div",{key:a,staticClass:"guide-line",class:e.type,style:e.style})})),0),e._l(e.template.fields,(function(a){return t("vue-draggable-resizable",{key:a.id,class:{"is-selected":e.selectedField&&e.selectedField.id===a.id,"is-locked":a.locked,"shift-pressed":e.isShiftPressed},attrs:{x:e.remToPx(a.x),y:e.remToPx(a.y),w:e.remToPx(a.width),h:e.remToPx(a.height),z:e.getZIndex(a),parent:!0,resizable:!a.locked,draggable:!a.locked,"min-width":50,"min-height":50},on:{activated:function(t){return e.selectField(a,t)},resizing:function(t,i,s,l){return e.onFieldUpdate(a,t,i,s,l)},dragging:function(t,i){return e.onFieldUpdate(a,t,i)},dragstop:e.onDragStop,resizestop:e.onResizeStop},nativeOn:{click:function(t){return t.stopPropagation(),e.selectField(a,t)}}},[t("div",{staticClass:"draggable-field",style:e.getFieldStyle(a)},["text"===a.type?t("span",[e._v(e._s(a.textContent))]):"image"===a.type&&a.imageUrl?t("img",{staticClass:"static-image-preview",attrs:{src:a.imageUrl}}):"image"===a.type?t("span",{staticClass:"placeholder-image"},[e._v(" Add Image ")]):"lucky_draw"===a.type?t("div",{staticClass:"lucky-number-container"},e._l((a.textContent||"").split(""),(function(i,s){return t("span",{key:s,staticClass:"digit-box",style:e.getDigitBoxStyle(a)},[e._v(" "+e._s(i)+" ")])})),0):e._e()])])}))],2)])])]),t("b-col",{staticClass:"bg-white border-left p-0 d-flex flex-column",staticStyle:{height:"100%","max-height":"100%"},attrs:{md:"2"}},[e.selectedField?t("div",{staticClass:"d-flex flex-column h-100"},[t("div",{staticClass:"p-2 overflow-auto flex-grow-1"},[t("div",{staticClass:"d-flex justify-content-between align-items-center mb-3"},[t("h5",{staticClass:"mb-0 text-truncate pr-2",staticStyle:{"font-size":"0.9rem"}},[e._v(e._s(e.selectedField.label))]),t("b-button",{staticClass:"p-0 flex-shrink-0",staticStyle:{width:"1.5rem",height:"1.5rem"},attrs:{variant:"light",size:"sm"},on:{click:e.deselectField}},[t("b-icon-x",{attrs:{"font-scale":"1.5"}})],1)],1),t("div",{staticClass:"mb-3 border-bottom pb-2"},[t("small",{staticClass:"text-muted d-block mb-1 font-weight-bold"},[e._v("Quick Align")]),t("b-button-group",{staticClass:"w-100",attrs:{size:"sm"}},[t("b-button",{attrs:{variant:"outline-primary",title:"Center Horizontally"},on:{click:function(t){return e.quickAlign("center-h")}}},[t("b-icon-align-center")],1),t("b-button",{attrs:{variant:"outline-primary",title:"Center Vertically"},on:{click:function(t){return e.quickAlign("center-v")}}},[t("b-icon-distribute-vertical")],1),t("b-button",{attrs:{variant:"outline-primary",title:"Dead Center"},on:{click:function(t){return e.quickAlign("center-full")}}},[t("b-icon-arrows-move")],1)],1)],1),t("b-tabs",{attrs:{"content-class":"mt-3",justified:"",small:""}},[["text","rectangle","lucky_draw"].includes(e.selectedField.type)?t("b-tab",{attrs:{title:"Style",active:"text"!==e.selectedField.type}},[["text","lucky_draw"].includes(e.selectedField.type)?t("div",[t("h6",{staticClass:"small font-weight-bold"},[e._v("Typography")]),t("b-row",{staticClass:"no-gutters"},[t("b-col",{staticClass:"pr-1",attrs:{cols:"6"}},[t("b-form-group",{attrs:{"label-size":"sm",label:"Font"}},[t("b-form-select",{staticStyle:{"font-size":"0.7rem"},attrs:{size:"sm",options:e.fontOptions},on:{change:e.recordHistory},model:{value:e.selectedField.fontFamily,callback:function(t){e.$set(e.selectedField,"fontFamily",t)},expression:"selectedField.fontFamily"}})],1)],1),t("b-col",{staticClass:"pl-1",attrs:{cols:"6"}},[t("b-form-group",{attrs:{"label-size":"sm",label:"Style"}},[t("b-form-select",{staticStyle:{"font-size":"0.7rem"},attrs:{size:"sm",options:e.fontStyleOptions},on:{change:e.recordHistory},model:{value:e.selectedField.fontStyle,callback:function(t){e.$set(e.selectedField,"fontStyle",t)},expression:"selectedField.fontStyle"}})],1)],1)],1),t("b-row",{staticClass:"no-gutters"},[t("b-col",{staticClass:"pr-1",attrs:{cols:"6"}},[t("b-form-group",{attrs:{"label-size":"sm",label:"Size (rem)"}},[t("b-form-input",{attrs:{size:"sm",type:"number",min:"0.5",step:"0.1"},on:{change:e.recordHistory},model:{value:e.selectedField.fontSize,callback:function(t){e.$set(e.selectedField,"fontSize",e._n(t))},expression:"selectedField.fontSize"}})],1)],1),t("b-col",{staticClass:"pl-1",attrs:{cols:"6"}},[t("b-form-group",{attrs:{"label-size":"sm",label:"Color"}},[t("b-form-input",{staticClass:"w-100",attrs:{size:"sm",type:"color"},on:{change:e.recordHistory},model:{value:e.selectedField.color,callback:function(t){e.$set(e.selectedField,"color",t)},expression:"selectedField.color"}})],1)],1)],1)],1):e._e(),"rectangle"===e.selectedField.type?t("div",{staticClass:"mt-3"},[t("h6",{staticClass:"small font-weight-bold"},[e._v("Fill")]),t("b-form-group",{attrs:{"label-size":"sm",label:"Background Color"}},[t("b-form-input",{attrs:{size:"sm",type:"color"},on:{change:e.recordHistory},model:{value:e.selectedField.backgroundColor,callback:function(t){e.$set(e.selectedField,"backgroundColor",t)},expression:"selectedField.backgroundColor"}})],1)],1):e._e(),t("hr",{staticClass:"my-2"}),t("h6",{staticClass:"small font-weight-bold"},[e._v("Border & Background")]),t("b-form-checkbox",{staticClass:"mb-2 small",attrs:{switch:""},on:{change:e.handleBorderToggleAndRecord},model:{value:e.selectedField.borderEnabled,callback:function(t){e.$set(e.selectedField,"borderEnabled",t)},expression:"selectedField.borderEnabled"}},[e._v("Enable Border")]),t("b-collapse",{model:{value:e.selectedField.borderEnabled,callback:function(t){e.$set(e.selectedField,"borderEnabled",t)},expression:"selectedField.borderEnabled"}},[t("div",{staticClass:"pt-1"},[t("b-form-group",{attrs:{"label-size":"sm",label:"Background Color"}},[t("b-form-input",{staticClass:"w-100",attrs:{size:"sm",type:"color"},on:{change:e.recordHistory},model:{value:e.selectedField.backgroundColor,callback:function(t){e.$set(e.selectedField,"backgroundColor",t)},expression:"selectedField.backgroundColor"}})],1),t("b-form-group",{staticClass:"mb-2",attrs:{"label-size":"sm",label:"Style"}},[t("b-form-select",{attrs:{size:"sm",options:["solid","dashed","dotted"]},on:{change:e.recordHistory},model:{value:e.selectedField.borderStyle,callback:function(t){e.$set(e.selectedField,"borderStyle",t)},expression:"selectedField.borderStyle"}})],1),t("b-row",{staticClass:"no-gutters"},[t("b-col",{staticClass:"pr-1",attrs:{cols:"6"}},[t("b-form-group",{attrs:{"label-size":"sm",label:"Width"}},[t("b-form-input",{attrs:{size:"sm",type:"number",min:"0",step:"0.06"},on:{change:e.recordHistory},model:{value:e.selectedField.borderWidth,callback:function(t){e.$set(e.selectedField,"borderWidth",e._n(t))},expression:"selectedField.borderWidth"}})],1)],1),t("b-col",{staticClass:"pl-1",attrs:{cols:"6"}},[t("b-form-group",{attrs:{"label-size":"sm",label:"Color"}},[t("b-form-input",{staticClass:"w-100",attrs:{size:"sm",type:"color"},on:{change:e.recordHistory},model:{value:e.selectedField.borderColor,callback:function(t){e.$set(e.selectedField,"borderColor",t)},expression:"selectedField.borderColor"}})],1)],1)],1),t("b-form-group",{attrs:{"label-size":"sm",label:"Radius (rem)"}},[t("b-form-input",{attrs:{size:"sm",type:"number",min:"0",step:"0.1"},on:{change:e.recordHistory},model:{value:e.selectedField.cornerRadius,callback:function(t){e.$set(e.selectedField,"cornerRadius",e._n(t))},expression:"selectedField.cornerRadius"}})],1)],1)])],1):e._e(),"image"===e.selectedField.type?t("b-tab",{attrs:{title:"Image"}},[t("b-form-group",{attrs:{"label-size":"sm",label:"Image Source"}},[t("b-form-file",{attrs:{accept:"image/*",placeholder:"Choose...",size:"sm"},on:{change:e.onStaticImageUpload}}),e.selectedField.imageUrl?t("b-button",{staticClass:"mt-2",attrs:{variant:"outline-danger",size:"sm",block:""},on:{click:e.clearStaticImage}},[e._v("Clear Image")]):e._e()],1)],1):e._e(),"lucky_draw"===e.selectedField.type?t("b-tab",{attrs:{title:"Number"}},[t("b-form-group",{attrs:{"label-size":"sm",label:"Digits"}},[t("b-form-select",{attrs:{size:"sm",options:[1,2,3,4,5,6,7,8]},on:{change:e.recordHistory},model:{value:e.selectedField.digitCount,callback:function(t){e.$set(e.selectedField,"digitCount",e._n(t))},expression:"selectedField.digitCount"}})],1)],1):e._e(),t("b-tab",{attrs:{title:"General",active:"text"===e.selectedField.type}},["text"===e.selectedField.type?t("b-form-group",{staticClass:"mb-3",attrs:{"label-size":"sm",label:"Data Source"}},[t("b-form-select",{attrs:{size:"sm",value:e.selectedField.fieldKey||"custom"},on:{change:e.updateFieldDataSourceAndRecord}},[t("b-form-select-option",{attrs:{value:null,disabled:""}},[e._v("--- Dynamic Fields ---")]),e._l(e.fieldDefinitions,(function(a){return t("b-form-select-option",{key:a.key,attrs:{value:a.key,disabled:e.isFieldKeyInUse(a.key)}},[e._v(" "+e._s(a.label)+" "+e._s(e.isFieldKeyInUse(a.key)?"(Already Added)":"")+" ")])}))],2)],1):e._e(),"text"===e.selectedField.type?t("b-row",{staticClass:"no-gutters"},[t("b-col",{staticClass:"mb-2",attrs:{cols:"12"}},[t("b-form-group",{staticClass:"m-0",attrs:{"label-size":"sm",label:"Label"}},[t("b-form-input",{attrs:{size:"sm"},on:{change:e.recordHistory},model:{value:e.selectedField.label,callback:function(t){e.$set(e.selectedField,"label",t)},expression:"selectedField.label"}})],1)],1),t("b-col",{attrs:{cols:"12"}},[t("b-form-group",{staticClass:"m-0",attrs:{"label-size":"sm",label:"Content"}},[t("b-form-input",{attrs:{size:"sm"},on:{change:e.recordHistory},model:{value:e.selectedField.textContent,callback:function(t){e.$set(e.selectedField,"textContent",t)},expression:"selectedField.textContent"}})],1)],1)],1):t("b-form-group",{attrs:{"label-size":"sm",label:"Label"}},[t("b-form-input",{attrs:{size:"sm"},on:{change:e.recordHistory},model:{value:e.selectedField.label,callback:function(t){e.$set(e.selectedField,"label",t)},expression:"selectedField.label"}})],1),t("hr",{staticClass:"my-3"}),t("div",{staticClass:"d-flex justify-content-between align-items-center mb-3"},[t("span",{staticClass:"small font-weight-bold"},[e._v("Lock Position")]),t("b-form-checkbox",{attrs:{switch:""},on:{change:e.recordHistory},model:{value:e.selectedField.locked,callback:function(t){e.$set(e.selectedField,"locked",t)},expression:"selectedField.locked"}})],1),t("b-button",{staticClass:"mt-2",attrs:{variant:"danger",size:"sm",block:""},on:{click:function(t){return e.deleteField(e.selectedField.id)}}},[t("b-icon-trash"),e._v(" Delete")],1)],1)],1)],1)]):t("div",{staticClass:"d-flex flex-column h-100"},[t("div",{staticClass:"p-2 border-bottom flex-shrink-0"},[t("h5",{staticClass:"mb-3",staticStyle:{"font-size":"1rem"}},[e._v("Template Settings")]),t("b-form-group",{attrs:{"label-size":"sm",label:"Background Color"}},[t("b-form-input",{attrs:{size:"sm",type:"color"},on:{change:e.recordHistory},model:{value:e.template.backgroundColor,callback:function(t){e.$set(e.template,"backgroundColor",t)},expression:"template.backgroundColor"}})],1),t("hr"),t("b-form-group",{staticClass:"mb-0",attrs:{"label-size":"sm",label:"Background Image"}},[e.template.backgroundImage?t("div",[t("div",{staticClass:"mb-2 p-1 border rounded bg-light"},[t("img",{staticStyle:{"max-width":"100%",height:"auto","max-height":"100px",display:"block",margin:"0 auto"},attrs:{src:e.template.backgroundImage}})]),t("div",{staticClass:"text-truncate text-muted small mb-2 text-center"},[e._v(e._s(e.template.backgroundImageName||"Uploaded Image"))]),t("b-button",{attrs:{variant:"outline-danger",size:"sm",block:""},on:{click:e.discardBackground}},[t("b-icon-trash",{staticClass:"mr-1"}),e._v(" Remove")],1)],1):t("div",[t("b-form-file",{attrs:{placeholder:"Choose image...",accept:"image/*",size:"sm"},on:{change:e.onBackgroundUpload}})],1)])],1),t("div",{staticClass:"p-2 border-bottom bg-light d-flex justify-content-between align-items-center flex-shrink-0"},[t("h6",{staticClass:"mb-0 text-primary font-weight-bold"},[e._v("Layers / Elements")]),t("b-badge",{attrs:{variant:"secondary"}},[e._v(e._s(e.template.fields.length))])],1),t("div",{staticClass:"flex-grow-1 overflow-auto bg-light custom-layers-scroll"},[0===e.template.fields.length?t("div",{staticClass:"text-muted small text-center py-5"},[e._v(" No elements added yet. ")]):t("div",{staticClass:"list-group list-group-flush small"},e._l(e.template.fields.slice().reverse(),(function(a,i){return t("div",{key:a.id,staticClass:"list-group-item list-group-item-action d-flex align-items-center justify-content-between px-2 py-2 cursor-pointer border-bottom",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.selectField(a)}}},[t("div",{staticClass:"d-flex align-items-center text-truncate"},["text"===a.type?t("b-icon-type",{staticClass:"mr-2 text-primary"}):"rectangle"===a.type?t("b-icon-square",{staticClass:"mr-2 text-success"}):"lucky_draw"===a.type?t("b-icon-hash",{staticClass:"mr-2 text-danger"}):t("b-icon-card-image",{staticClass:"mr-2 text-warning"}),t("span",{staticClass:"text-truncate",staticStyle:{"max-width":"110px"}},[e._v(e._s(a.label))])],1),a.locked?t("b-icon-lock-fill",{staticClass:"text-muted",attrs:{"font-scale":"0.8"}}):e._e()],1)})),0)])])])],1)],1),t("b-modal",{attrs:{title:"Previous Session Detected","no-close-on-backdrop":"","no-close-on-esc":"","hide-header-close":"",centered:"","header-bg-variant":"warning","header-text-variant":"dark"},scopedSlots:e._u([{key:"modal-footer",fn:function(){return[t("b-button",{attrs:{variant:"primary"},on:{click:e.resumeDraft}},[t("b-icon-pencil-square",{staticClass:"mr-1"}),e._v(" Resume Editing ")],1)]},proxy:!0}]),model:{value:e.showDraftModal,callback:function(t){e.showDraftModal=t},expression:"showDraftModal"}},[t("p",[e._v("We found a local draft from your previous session for "),t("strong",[e._v(e._s(e.luckyDrawType))]),e._v(". Would you like to resume editing this draft")])])],1)},s=[],l=a("5530"),r=a("c7eb"),o=a("1da1"),n=(a("38cf"),a("ac1f"),a("5319"),a("e9c4"),a("14d9"),a("7db0"),a("d3b7"),a("b0c0"),a("d9e2"),a("d81d"),a("99af"),a("4de4"),a("c740"),a("a434"),a("159b"),a("2532"),a("25f0"),a("d0b9")),c=a("8f77"),d=a("042b"),u=a("1bbb"),h=a("a15b"),m=a("b28b"),f=a("1947"),p=a("12aa"),b=a("205f"),g=a("11de"),y=a("8226"),v=a("4797"),k=a("8361"),S=a("ea4c"),C=a("c3e6"),x=a("c43f"),w=a("f902"),_=a("6190"),T=a("5843"),F=a("7386"),I=a("01e3"),D=a("6aac"),E=a("e98b"),B=a("fb19"),z=a.n(B),A=(a("278f"),16),O=10,N={name:"DynamicTemplateDesigner",components:{BNavbar:n["a"],BNavbarBrand:c["a"],BNavbarNav:d["a"],BContainer:u["a"],BRow:h["a"],BCol:m["a"],BButton:f["a"],BButtonGroup:p["a"],BCard:b["a"],BForm:g["a"],BFormGroup:y["a"],BFormInput:v["a"],BFormSelect:k["a"],BFormSelectOption:S["a"],BFormCheckbox:C["a"],BFormFile:x["a"],BTabs:w["a"],BTab:_["a"],BCollapse:T["a"],BIconUpload:F["Bz"],BIconPlusLg:F["lu"],BIconInputCursorText:F["pq"],BIconTrash:F["Py"],BIconX:F["gA"],BIconSave:F["hv"],BIconChevronUp:F["Gh"],BIconChevronDown:F["Ch"],BIconCardImage:F["Mf"],BIconSquare:F["bx"],BIconHash:F["vp"],BIconType:F["iz"],BIconTrophy:F["Yy"],BSpinner:I["a"],BIconCheck2:F["dh"],BModal:D["a"],BIconPencilSquare:F["kt"],BBadge:E["a"],BIconArrowLeft:F["O"],BIconAlignCenter:F["d"],BIconDistributeVertical:F["kk"],BIconArrowsMove:F["zb"],BIconLayers:F["Yq"],BIconInfoCircle:F["jq"],BIconLockFill:F["Gr"],BIconArrowCounterclockwise:F["w"],BIconArrowClockwise:F["v"],VueDraggableResizable:z.a},data:function(){return{template:{backgroundColor:"#fbe9e7",backgroundImage:null,backgroundImageName:null,fields:[]},selectedField:null,lastSavedState:"",isTemplateSaved:!1,isCustomFieldsVisible:!0,draftStatus:"clean",autoSaveTimer:null,showDraftModal:!1,isLoading:!0,designId:null,designType:null,luckyDrawType:"Live Draw",saveStatus:"idle",historyStack:[],historyIndex:-1,isUndoing:!1,fontOptions:["Arial","Roboto","Impact","Georgia","Verdana","Times New Roman","Courier New","monospace"],fontStyleOptions:["Normal","Bold","Italic","Bold Italic"],canvasSize:{width:0,height:0},alignmentLines:[],isShiftPressed:!1,fieldDefinitions:[{key:"winner_name",label:"Winner's Name",defaultContent:"JANE DOE"},{key:"company_name",label:"Company Name",defaultContent:"Your Company"},{key:"prize_pos",label:"Prize Position",defaultContent:"1st Prize"},{key:"prize_desc",label:"Prize Description",defaultContent:"A Brand New Laptop"},{key:"department",label:"Department",defaultContent:"Marketing Dept"},{key:"employee_id",label:"Employee ID",defaultContent:"EMP-12345"}],allCustomFields:[{type:"text",label:"Label / Text",defaultContent:"Text"},{type:"lucky_draw",label:"Lucky Draw Number"},{type:"rectangle",label:"Border Container"},{type:"background_upload",label:"Background Image"}]}},watch:{selectedField:{handler:function(e){e&&"lucky_draw"===e.type&&e.digitCount&&(e.textContent="8".repeat(e.digitCount))},deep:!0},template:{handler:function(){this.isLoading||this.isUndoing||this.triggerAutoSave()},deep:!0}},created:function(){this.designId=this.$route.query.BACKDROP_TEMPLATE_SYS_ID,this.designType=sessionStorage.getItem("currentBackdropDesignType")||"Custom Template",this.luckyDrawType=sessionStorage.getItem("currentBackdropDrawType")||"Live Draw",this.checkForDraft(),window.addEventListener("resize",this.updateCanvasSize)},mounted:function(){var e=this;this.$nextTick((function(){e.updateCanvasSize(),0===e.historyStack.length&&e.recordHistory()})),window.addEventListener("keydown",this.handleGlobalKeydown),window.addEventListener("keyup",this.handleGlobalKeyup)},beforeDestroy:function(){window.removeEventListener("resize",this.updateCanvasSize),window.removeEventListener("keydown",this.handleGlobalKeydown),window.removeEventListener("keyup",this.handleGlobalKeyup)},computed:{canUndo:function(){return this.historyIndex>0},canRedo:function(){return this.historyIndex<this.historyStack.length-1},storageKey:function(){return this.designId?"dynamicBackdropTemplate_".concat(this.designId):"dynamicBackdropTemplate_".concat((this.luckyDrawType||"default").replace(/\s+/g,"_"))},hasUnsavedChanges:function(){return JSON.stringify(this.template)!==this.lastSavedState},backgroundStyle:function(){return{backgroundColor:this.template.backgroundColor,backgroundImage:this.template.backgroundImage?"url(".concat(this.template.backgroundImage,")"):"none",backgroundSize:"cover",backgroundPosition:"center"}},rulerGridStyle:function(){return{display:"grid",gridTemplateColumns:"20px 1fr",gridTemplateRows:"20px 1fr",width:"".concat(this.canvasSize.width+20,"px"),height:"".concat(this.canvasSize.height+20,"px")}},canvasSizeStyle:function(){return{width:"".concat(this.canvasSize.width,"px"),height:"".concat(this.canvasSize.height,"px"),position:"relative"}},xTicks:function(){for(var e=[],t=0;t<=this.canvasSize.width;t+=100)e.push(t);return e},yTicks:function(){for(var e=[],t=0;t<=this.canvasSize.height;t+=100)e.push(t);return e}},methods:{recordHistory:function(){if(!this.isUndoing){this.historyIndex<this.historyStack.length-1&&(this.historyStack=this.historyStack.slice(0,this.historyIndex+1));var e=JSON.stringify(this.template);this.historyStack.length>0&&this.historyStack[this.historyStack.length-1]===e||(this.historyStack.push(e),this.historyIndex++,this.historyStack.length>50&&(this.historyStack.shift(),this.historyIndex--))}},undo:function(){var e=this;this.canUndo&&(this.isUndoing=!0,this.historyIndex--,this.restoreState(this.historyStack[this.historyIndex]),this.$nextTick((function(){e.isUndoing=!1})))},redo:function(){var e=this;this.canRedo&&(this.isUndoing=!0,this.historyIndex++,this.restoreState(this.historyStack[this.historyIndex]),this.$nextTick((function(){e.isUndoing=!1})))},restoreState:function(e){var t=this;try{var a=JSON.parse(e);if(this.template=a,this.selectedField){var i=this.template.fields.find((function(e){return e.id===t.selectedField.id}));this.selectedField=i||null}}catch(s){console.error("Failed to restore history state",s)}},handleBorderToggleAndRecord:function(e){this.handleBorderToggle(e),this.recordHistory()},updateFieldDataSourceAndRecord:function(e){this.updateFieldDataSource(e),this.recordHistory()},onDragStop:function(){this.clearGuidelines(),this.recordHistory()},onResizeStop:function(e,t,a,i){this.clearGuidelines(),this.recordHistory()},pxToRem:function(e){return e/A},remToPx:function(e){return e*A},getZIndex:function(e){var t=0;return t="rectangle"===e.type?1:"image"===e.type?10:20,this.selectedField&&this.selectedField.id===e.id&&(t+=999),t},getTemplateDefaultsByType:function(e){return{backgroundColor:"#fbe9e7",backgroundImage:null,backgroundImageName:null,fields:[]}},checkForDraft:function(){var e=localStorage.getItem(this.storageKey);if(e)try{var t=JSON.parse(e);t.template?this.showDraftModal=!0:this.loadTemplate("default")}catch(a){this.loadTemplate("default")}else this.loadTemplate("default")},resumeDraft:function(){var e=this,t=localStorage.getItem(this.storageKey);if(t){var a=JSON.parse(t);!1===a.isDirty?this.loadTemplate("local_silent",a.template):this.loadTemplate("local",a.template)}this.showDraftModal=!1,this.$nextTick((function(){e.historyStack=[],e.historyIndex=-1,e.recordHistory()}))},discardDraft:function(){var e=this;localStorage.removeItem(this.storageKey),this.loadTemplate("default"),this.showDraftModal=!1,this.draftStatus="clean",this.$nextTick((function(){e.historyStack=[],e.historyIndex=-1,e.recordHistory()}))},loadTemplate:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.isLoading=!0;try{if("local"===e||"local_silent"===e){var i=a;if(!i){var s=JSON.parse(localStorage.getItem(this.storageKey));i=s.template||s}i&&(this.template=i,this.isTemplateSaved="local_silent"===e,this.draftStatus="saved")}else this.template=this.getTemplateDefaultsByType(this.luckyDrawType),this.isTemplateSaved=!1,this.draftStatus="clean"}catch(l){console.error("Error loading template",l),this.template=this.getTemplateDefaultsByType(this.luckyDrawType)}this.lastSavedState="local_silent"===e?JSON.stringify(this.template):"local"===e?"":JSON.stringify(this.template),this.$nextTick((function(){t.isLoading=!1}))},triggerAutoSave:function(){var e=this;this.draftStatus="saving",this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout((function(){e.saveDraftLocally()}),2e3)},saveDraftLocally:function(){try{var e={template:this.template,isDirty:!0,timestamp:Date.now()};localStorage.setItem(this.storageKey,JSON.stringify(e)),this.draftStatus="saved"}catch(t){console.error("Failed to auto-save draft:",t)}},onBackgroundUpload:function(e){var t=this,a=e.target.files[0];if(a){var i=new FileReader;i.onload=function(e){t.template.backgroundImage=e.target.result,t.recordHistory()},i.readAsDataURL(a),this.uploadBackgroundImage(a)}},uploadBackgroundImage:function(e){var t=this;return Object(o["a"])(Object(r["a"])().mark((function a(){var i,s,l,o,n;return Object(r["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.saveStatus="saving",a.prev=1,i=new FormData,i.append("files[]",e),a.next=6,t.$apiCall.post(t.$apiBus.file_upload,i,{headers:{"Content-Type":"multipart/form-data"},timeout:3e4});case 6:if(s=a.sent,l=(null===s||void 0===s?void 0:s.data)||s,"true"!==(null===l||void 0===l?void 0:l.status)&&!0!==(null===l||void 0===l?void 0:l.success)){a.next=12;break}t.template.backgroundImageName=(null===l||void 0===l||null===(o=l.files)||void 0===o||null===(n=o[0])||void 0===n?void 0:n.filename)||(null===l||void 0===l?void 0:l.filename)||e.name,a.next=13;break;case 12:throw new Error("File upload API returned an error status.");case 13:a.next=20;break;case 15:a.prev=15,a.t0=a["catch"](1),console.error("Background image upload failed:",a.t0),alert("Background image failed to upload. It will not be saved."),t.discardBackground();case 20:return a.prev=20,t.saveStatus="idle",a.finish(20);case 23:case"end":return a.stop()}}),a,null,[[1,15,20,23]])})))()},discardBackground:function(){this.template.backgroundImage=null,this.template.backgroundImageName=null,this.recordHistory()},goBackToEvent:function(){if(this.hasUnsavedChanges){var e=confirm("You have unsaved changes. Are you sure you want to go back without saving?");if(!e)return}this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.$router?this.$router.go(-1):window.history.back()},saveTemplate:function(){var e=this;if(this.designId){var t=localStorage.getItem("selectedOrganizationSysId"),a=localStorage.getItem("selectedEventSysId");if(t&&a){this.saveStatus="saving";var i=this.canvasSize.width,s=this.canvasSize.height;if(0!==i&&0!==s){var l=function(e){return String(16*parseFloat(e||0)/i*100)},r=function(e){return String(16*parseFloat(e||0)/s*100)},o=function(t){return e.template.fields.some((function(e){return e.fieldKey===t}))?"1":"0"},n=this.template.fields.find((function(e){return"rectangle"===e.type}))||{},c=this.template.fields.map((function(t){var a=t.fieldKey?t.fieldKey.toUpperCase():(t.label||t.type).toUpperCase().replace(/\s+/g,"_");"Pre-Live Draw"===e.luckyDrawType&&t.fieldKey&&t.dataIndex&&(a="".concat(a,"_").concat(t.dataIndex));var i="transparent";return i="text"===t.type||"lucky_draw"===t.type?t.borderEnabled&&t.backgroundColor||"transparent":t.backgroundColor||"transparent",{ELEMENT_NAME:a,ELEMENT_CONTENT:t.textContent||"",X_POSITION:l(t.x),WIDTH:l(t.width),Y_POSITION:r(t.y),HEIGHT:r(t.height),NO_OF_DIGITS:String(t.digitCount||""),FONT_FAMILY:t.fontFamily||"Arial",FONT_STYLE:t.fontStyle||"Normal",FONT_SIZE:l(t.fontSize||1.5),FONT_COLOR:t.color||"#000000",BACKGROUND_COLOR:i,BORDER_STYLE:t.borderStyle||"solid",BORDER_COLOR:t.borderColor||"#000000",BORDER_WIDTH:t.borderEnabled?l(t.borderWidth||0):"0",CORNER_RADIUS:l(t.cornerRadius||0),LOCK_POSITION_AND_SIZE:t.locked?"1":"0",CREATED_BY:1}})),d={ITEM:"ADD_UPDATE_BT_DESIGN_SETUP",ORGANIZATION_SYS_ID:t,BACKDROP_TEMPLATE_SYS_ID:this.designId,EVENT_SYS_ID:a,TEMPLATE_NAME:this.designType,CREATED_BY:1,BACKGROUND_COLOR:this.template.backgroundColor,BACKGROUND_IMAGE:this.template.backgroundImageName||"",CANVAS_WIDTH:String(i),CANVAS_HEIGHT:String(s),COMPANY_NAME:o("company_name"),PRIZE_POSITION:o("prize_pos"),PRIZE_DESCRIPTION:o("prize_desc"),LUCKY_DRAW_NO:this.template.fields.some((function(e){return"lucky_draw"===e.type}))?"1":"0",WINNER_NAME:o("winner_name"),DEPARTMENT:o("department"),EMP_ID:o("employee_id"),BORDER_STYLE:n.borderStyle||"solid",BORDER_COLOR:n.borderColor||"#000000",BORDER_WIDTH:n.borderEnabled?l(n.borderWidth||0):"0",CORNER_RADIUS:l(n.cornerRadius||0),BORDER_BACKGROUND_COLOR:n.backgroundColor||"transparent",ELEMENT_DETAILS:c},u={ITEM:"ADD_UPDATE_BT_SETUP",ORGANIZATION_SYS_ID:t,BACKDROP_TEMPLATE_SYS_ID:this.designId,EVENT_SYS_ID:a,TEMPLATE_NAME:this.designType,LUCKY_DRAW_TYPE:this.luckyDrawType,json_document:JSON.stringify(d),CREATED_BY:1};this.$apiCall.post(this.$apiBus.api_post_backdrop_design,u).then((function(t){if(!t.status||"true"!==t.status)throw new Error(t.message||"Failed to save design details.");var a={template:e.template,isDirty:!1,timestamp:Date.now()};localStorage.setItem(e.storageKey,JSON.stringify(a)),e.isTemplateSaved=!0,e.lastSavedState=JSON.stringify(e.template),e.saveStatus="saved",e.draftStatus="clean",e.autoSaveTimer&&clearTimeout(e.autoSaveTimer)})).catch((function(t){console.error("API Save Error:",t),alert("Save Failed: ".concat(t.message)),e.saveStatus="idle"}))}else alert("Error: Canvas dimensions are not calculated yet.")}else alert("Error: Missing Organization or Event ID.")}else alert("Error: Missing Template ID.")},deleteTemplate:function(){var e=this;return Object(o["a"])(Object(r["a"])().mark((function t(){var a,i,s;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(confirm('Are you sure you want to delete the "'.concat(e.designType,'" template?'))){t.next=2;break}return t.abrupt("return");case 2:if(a=localStorage.getItem("selectedEventSysId"),a&&e.designId){t.next=6;break}return alert("Error: Missing IDs."),t.abrupt("return");case 6:return e.autoSaveTimer&&clearTimeout(e.autoSaveTimer),e.isLoading=!0,i={ITEM:"DELETE_TEMPLATE",EVENT_SYS_ID:a,BACKDROP_TEMPLATE_SYS_ID:e.designId},t.prev=9,t.next=12,e.$apiCall.post(e.$apiBus.api_post_backdrop_design,i);case 12:if(s=t.sent,"true"===s.status){t.next=15;break}throw new Error(s.message||"Failed to delete template.");case 15:localStorage.removeItem(e.storageKey),sessionStorage.removeItem("currentBackdropDesignType"),sessionStorage.removeItem("currentBackdropDrawType"),e.template=e.getTemplateDefaultsByType(e.luckyDrawType),e.isTemplateSaved=!1,e.draftStatus="clean",e.lastSavedState=JSON.stringify(e.template),e.historyStack=[],e.historyIndex=-1,e.recordHistory(),e.$router&&e.$router.go(-1),t.next=33;break;case 28:t.prev=28,t.t0=t["catch"](9),console.error("Failed to delete template:",t.t0),alert("An error occurred: ".concat(t.t0.message)),e.isLoading=!1;case 33:case"end":return t.stop()}}),t,null,[[9,28]])})))()},exportJson:function(){console.log(JSON.stringify(this.template,null,2)),alert("JSON logged to console!")},handleGlobalKeydown:function(e){if("Shift"===e.key&&(this.isShiftPressed=!0),(e.ctrlKey||e.metaKey)&&"z"===e.key.toLowerCase())return e.preventDefault(),void(e.shiftKey?this.redo():this.undo());if((e.ctrlKey||e.metaKey)&&"y"===e.key.toLowerCase())return e.preventDefault(),void this.redo();if(this.selectedField){if("Delete"===e.key||"Backspace"===e.key){var t=e.target,a="INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable;if(a)return;this.deleteField(this.selectedField.id)}var i=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key);if(i){var s=e.target;if("INPUT"===s.tagName||"TEXTAREA"===s.tagName)return;e.preventDefault();var l=e.shiftKey?1:.125;"ArrowUp"===e.key&&(this.selectedField.y-=l),"ArrowDown"===e.key&&(this.selectedField.y+=l),"ArrowLeft"===e.key&&(this.selectedField.x-=l),"ArrowRight"===e.key&&(this.selectedField.x+=l)}}},handleGlobalKeyup:function(e){"Shift"===e.key&&(this.isShiftPressed=!1);var t=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key);t&&this.selectedField&&"INPUT"!==document.activeElement.tagName&&this.recordHistory()},quickAlign:function(e){if(this.selectedField){var t=this.selectedField,a=this.canvasSize.width,i=this.canvasSize.height,s=this.remToPx(t.width),l=this.remToPx(t.height);"center-h"!==e&&"center-full"!==e||(t.x=this.pxToRem((a-s)/2)),"center-v"!==e&&"center-full"!==e||(t.y=this.pxToRem((i-l)/2)),this.recordHistory()}},handlePaletteDragStart:function(e,t){e.dataTransfer&&(e.dataTransfer.effectAllowed="copy",e.dataTransfer.setData("field",JSON.stringify(t)))},handlePaletteItemClick:function(e){"background_upload"===e.type&&this.deselectField()},handleCanvasDrop:function(e){var t,a=null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("field");if(a){var i=JSON.parse(a),s=this.$refs.canvasWrapper.getBoundingClientRect(),l=this.pxToRem(e.clientX-s.left),r=this.pxToRem(e.clientY-s.top);this.createNewElement(i,l,r)}},handleBorderToggle:function(e){e&&this.selectedField&&(this.selectedField.borderStyle||this.$set(this.selectedField,"borderStyle","solid"),this.selectedField.borderWidth&&0!==this.selectedField.borderWidth||this.$set(this.selectedField,"borderWidth",.125),this.selectedField.borderColor||this.$set(this.selectedField,"borderColor","#000000"),void 0===this.selectedField.cornerRadius&&this.$set(this.selectedField,"cornerRadius",0),this.selectedField.backgroundColor||this.$set(this.selectedField,"backgroundColor","#ffffff"))},createNewElement:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if("background_upload"!==e.type){var s="el_".concat(Date.now()),r={id:s,type:e.type,label:e.label,x:a,y:i,locked:!1},o={borderEnabled:!1,borderStyle:"solid",borderWidth:0,borderColor:"#000000",cornerRadius:0},n="Pre-Live Draw"===this.luckyDrawType||"Pre-Draw"===this.luckyDrawType;if("text"===e.type){var c=this.fieldDefinitions.find((function(e){return!t.template.fields.some((function(t){return t.fieldKey===e.key}))}));if(c){var d=c.defaultContent,u=c.label,h=1;if(n){var m=c||this.fieldDefinitions[0],f=this.template.fields.filter((function(e){return e.fieldKey===m.key})).length;h=f+1,r.fieldKey=m.key,d="".concat(m.defaultContent," ").concat(h),u="".concat(m.label," (").concat(h,")")}else r.fieldKey=c.key;Object.assign(r,Object(l["a"])({textContent:d,label:u,dataIndex:h,width:20,height:5,fontFamily:"Arial",fontStyle:"Normal",fontSize:1.5,color:"#000000"},o))}else{var p="New Text",b="Custom Text";if(n){var g=this.template.fields.filter((function(e){return"text"===e.type&&!e.fieldKey})).length,y=g+1;p="Text ".concat(y),b="Custom Text (".concat(y,")")}Object.assign(r,Object(l["a"])({textContent:p,label:b,width:20,height:5,fontFamily:"Arial",fontStyle:"Normal",fontSize:1.5,color:"#000000"},o))}}else if("rectangle"===e.type)Object.assign(r,{width:25,height:15,backgroundColor:"transparent",borderEnabled:!0,borderColor:"#000000",borderWidth:.125,cornerRadius:.5,borderStyle:"solid"});else if("lucky_draw"===e.type){var v="Lucky Draw Number",k=0,S="lucky_draw_no";if(n){var C=this.template.fields.filter((function(e){return"lucky_draw"===e.type})).length;k=C+1,v="Lucky Draw Number (".concat(k,")")}Object.assign(r,Object(l["a"])({textContent:"8888",digitCount:4,width:28,height:7.5,fontFamily:"Arial",fontStyle:"Bold",color:"#000000",fieldKey:S,dataIndex:k,label:v},o))}this.template.fields.push(r),this.selectedField=r,this.recordHistory()}else this.deselectField()},isFieldKeyInUse:function(e){var t=this;return"Pre-Live Draw"!==this.luckyDrawType&&"Pre-Draw"!==this.luckyDrawType&&(!!this.selectedField&&this.template.fields.some((function(a){return a.id!==t.selectedField.id&&a.fieldKey===e})))},updateFieldDataSource:function(e){var t=this;if(this.selectedField){if("custom"===e)return this.selectedField.fieldKey=null,this.selectedField.dataIndex=null,void(this.selectedField.label="Custom Text");var a=this.fieldDefinitions.find((function(t){return t.key===e}));if(a)if(this.selectedField.fieldKey=a.key,"Pre-Live Draw"===this.luckyDrawType||"Pre-Draw"===this.luckyDrawType){var i=this.template.fields.filter((function(a){return a.id!==t.selectedField.id&&a.fieldKey===e})).length,s=i+1;this.selectedField.dataIndex=s,this.selectedField.label="".concat(a.label," (").concat(s,")"),this.selectedField.textContent="".concat(a.defaultContent," ").concat(s)}else this.selectedField.label=a.label,this.selectedField.textContent=a.defaultContent,this.selectedField.dataIndex=1}},selectField:function(e,t){t&&t.stopPropagation(),this.selectedField=e},deselectField:function(){this.selectedField=null},deleteField:function(e){var t=this.template.fields.findIndex((function(t){return t.id===e}));t>-1&&(this.template.fields.splice(t,1),this.deselectField(),this.recordHistory())},onFieldUpdate:function(e,t,a,i,s){if(e&&!e.locked){var l=e.width,r=e.height,o=!1;if("number"===typeof i&&i>0&&(l=this.pxToRem(i),Math.abs(l-e.width)>.01&&(o=!0),e.width=l),"number"===typeof s&&s>0&&(r=this.pxToRem(s),Math.abs(r-e.height)>.01&&(o=!0),e.height=r),"number"===typeof t&&"number"===typeof a){var n=this.calculateSnapping(e,t,a,this.remToPx(e.width),this.remToPx(e.height)),c=this.pxToRem(n.x),d=this.pxToRem(n.y),u=c-e.x,h=d-e.y;e.x=c,e.y=d,o||"rectangle"!==e.type||0===u&&0===h||this.isShiftPressed||this.moveContainedElements(e,u,h)}}},moveContainedElements:function(e,t,a){var i=e.x,s=e.x+e.width,l=e.y,r=e.y+e.height;this.template.fields.forEach((function(o){if(o.id!==e.id&&!o.locked){var n=o.x+o.width/2,c=o.y+o.height/2,d=n>=i&&n<=s&&c>=l&&c<=r;d&&(o.x+=t,o.y+=a)}}))},calculateSnapping:function(e,t,a,i,s){this.alignmentLines=[];var l=this.canvasSize.width,r=this.canvasSize.height,o=t+i/2,n=a+s/2,c=t,d=a,u=!1,h=!1;Math.abs(o-l/2)<O?(c=l/2-i/2,u=!0):Math.abs(t-0)<O?(c=0,u=!0):Math.abs(t+i-l)<O&&(c=l-i,u=!0),Math.abs(n-r/2)<O?(d=r/2-s/2,h=!0):Math.abs(a-0)<O?(d=0,h=!0):Math.abs(a+s-r)<O&&(d=r-s,h=!0);var m=c+i/2,f=d+s/2;return this.addFullLine("vertical",m,u),this.addFullLine("horizontal",f,h),{x:c,y:d}},addFullLine:function(e,t,a){var i="vertical"===e?{left:"".concat(t,"px"),top:0,bottom:0}:{top:"".concat(t,"px"),left:0,right:0},s=[e,a?"snapped":"tracking"];this.alignmentLines.push({type:s,style:i})},clearGuidelines:function(){this.alignmentLines=[]},getFontWeightAndStyle:function(e){var t="normal",a="normal";if(e.fontStyle){var i=e.fontStyle.toLowerCase();i.includes("bold")&&(t="bold"),i.includes("italic")&&(a="italic")}return{fontWeight:t,fontStyle:a}},getDigitBoxStyle:function(e){var t=(e.textContent||"").toString().length;if(0===t)return{};var a=this.remToPx(e.width),i=this.remToPx(e.height),s=15,l=s*(t-1),r=(a-l)/t,o=Math.min(r,i),n=.7*o,c=this.getFontWeightAndStyle(e),d=c.fontWeight,u=c.fontStyle;return{width:"".concat(o,"px"),height:"".concat(o,"px"),fontSize:"".concat(n,"px"),fontFamily:e.fontFamily||"Arial",color:e.color||"#000000",fontWeight:d,fontStyle:u}},getFieldStyle:function(e){var t={width:"100%",height:"100%",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},a={};if(e.borderEnabled?(a={border:"".concat(e.borderWidth||0,"rem ").concat(e.borderStyle||"solid"," ").concat(e.borderColor||"#000000"),borderRadius:"".concat(e.cornerRadius||0,"rem")},"text"!==e.type&&"lucky_draw"!==e.type||(a.backgroundColor=e.backgroundColor||"transparent")):(a={border:"none"},"text"!==e.type&&"lucky_draw"!==e.type||(a.backgroundColor="transparent")),"rectangle"===e.type)return Object(l["a"])(Object(l["a"])({},t),{},{backgroundColor:e.backgroundColor||"transparent"},a);if("text"===e.type||"lucky_draw"===e.type){var i=this.getFontWeightAndStyle(e),s=i.fontWeight,r=i.fontStyle;return Object(l["a"])(Object(l["a"])(Object(l["a"])({},t),{},{fontFamily:e.fontFamily||"Arial",fontSize:"".concat(e.fontSize||1.5,"rem"),color:e.color||"#000000",fontWeight:s,fontStyle:r,whiteSpace:"pre-wrap",wordBreak:"break-word"},"text"===e.type&&a),"lucky_draw"===e.type&&a)}return t},updateCanvasSize:function(){var e,t,a=null===(e=this.$refs.canvasWrapper)||void 0===e||null===(t=e.parentElement)||void 0===t?void 0:t.parentElement;if(a){var i=16/9,s=a.clientWidth-40,l=a.clientHeight-40,r=s,o=r/i;o>l&&(o=l,r=o*i),this.canvasSize={width:r,height:o}}},onStaticImageUpload:function(e){var t=this,a=e.target.files[0];if(a&&this.selectedField){var i=new FileReader;i.onload=function(e){t.selectedField.imageUrl=e.target.result,t.recordHistory()},i.readAsDataURL(a)}},clearStaticImage:function(){this.selectedField&&(this.selectedField.imageUrl=null,this.recordHistory())}}},R=N,L=(a("0db2"),a("2877")),P=Object(L["a"])(R,i,s,!1,null,"0db13af9",null);t["default"]=P.exports}}]);